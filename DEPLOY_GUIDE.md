# üöÄ Deploy Guide - LaMa Anime/Manga Inpainting

## üìã –ß—Ç–æ –≥–æ—Ç–æ–≤–æ

‚úÖ **CPU Docker –æ–±—Ä–∞–∑**: `lama-anime-cpu:latest` (4.77GB)  
‚úÖ **–ú–æ–¥–µ–ª—å**: `lama_large_512px.ckpt` (–æ–±—É—á–µ–Ω–∞ –Ω–∞ –∞–Ω–∏–º–µ/–º–∞–Ω–≥–µ)  
‚úÖ **RunPod –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: `runpod_cpu.yaml`  
‚úÖ **CPU –æ–±—Ä–∞–±–æ—Ç—á–∏–∫**: `rp_handler_cpu.py`  
‚úÖ **–¢–µ—Å—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã**: –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é  
‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –ø–æ–ª–Ω–∞—è  

## üéØ –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π –Ω–∞ RunPod

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
git clone https://github.com/alihojaev/comics-inpaint.git
cd comics-inpaint

# –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –º–æ–¥–µ–ª—å –Ω–∞ –º–µ—Å—Ç–µ
ls -lh lama_large_512px.ckpt  # –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ~195MB
```

### 2. –î–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ RunPod CLI

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å RunPod CLI
pip install runpod

# –í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç RunPod
runpod login

# –î–µ–ø–ª–æ–π CPU –≤–µ—Ä—Å–∏–∏
runpod deploy --template runpod_cpu.yaml
```

### 3. –î–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

1. –ó–∞–π—Ç–∏ –Ω–∞ [RunPod Console](https://console.runpod.io/serverless)
2. –ù–∞–∂–∞—Ç—å "New Endpoint"
3. –í—ã–±—Ä–∞—Ç—å "Custom Template"
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ `runpod_cpu.yaml`:
   - **GPU**: Disabled
   - **Container Disk**: 10GB
   - **Idle Timeout**: 30 seconds
   - **Max Workers**: 1

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –¢–µ—Å—Ç —Å –≤–∞—à–∏–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
python3 test_custom.py

# –¢–µ—Å—Ç —á–µ—Ä–µ–∑ Docker
docker run --rm --memory="6g" \
    -v $(pwd)/test_input:/app/test_input \
    -v $(pwd)/outputs:/app/outputs \
    lama-anime-cpu:latest
```

### –¢–µ—Å—Ç RunPod API

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
export RUNPOD_ENDPOINT="https://api.runpod.ai/v2/YOUR_ENDPOINT_ID/runsync"
export RUNPOD_API_KEY="your_api_key_here"

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç
python3 test_runpod_api.py
```

## üì° API –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞

```json
{
  "input": {
    "image": "data:image/jpeg;base64,/9j/4AAQ...",
    "mask": "data:image/png;base64,iVBORw0KGgo..."
  }
}
```

### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞

```json
{
  "status": "ok",
  "image_base64": "/9j/4AAQ...",
  "metadata": {
    "input_size": [720, 1098],
    "output_size": [512, 328],
    "device": "cpu",
    "model": "lama_large_512px_anime_manga"
  }
}
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|----------|----------|
| `MODEL_DIR` | `/app/local-model` | –ü—É—Ç—å –∫ –º–æ–¥–µ–ª–∏ |
| `MODEL_CKPT` | `best_genpref.ckpt` | –ò–º—è —á–µ–∫–ø–æ–∏–Ω—Ç–∞ |
| `DEVICE` | `cpu` | –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ |
| `MAX_SIZE` | `1024` | –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è |

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

```yaml
# –î–ª—è –±—ã—Å—Ç—Ä–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
MAX_SIZE: "512"

# –î–ª—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏  
MAX_SIZE: "1024"

# –î–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
MAX_SIZE: "1536"
```

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –†–∞–∑–º–µ—Ä | –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ | –ü–∞–º—è—Ç—å |
|--------|-----------------|--------|
| 512x512 | ~15-30 —Å–µ–∫ | ~4GB |
| 1024x1024 | ~30-60 —Å–µ–∫ | ~6GB |
| 1536x1536 | ~60-120 —Å–µ–∫ | ~8GB |

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å RunPod

- **Cold start**: ~$0.01-0.02 –∑–∞ –∑–∞–ø—Ä–æ—Å
- **Warm inference**: ~$0.005-0.01 –∑–∞ –∑–∞–ø—Ä–æ—Å
- **–•–æ–ª–æ–¥–Ω—ã–π —Å—Ç–∞—Ä—Ç**: ~10-15 —Å–µ–∫
- **–¢–µ–ø–ª—ã–π –∏–Ω—Ñ–µ—Ä–µ–Ω—Å**: ~10-20 —Å–µ–∫

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "Out of memory"
```yaml
# –£–º–µ–Ω—å—à–∏—Ç–µ MAX_SIZE
MAX_SIZE: "512"
```

### –û—à–∏–±–∫–∞: "Model not found"
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–æ–¥–µ–ª—å
ls -lh local-model/models/best_genpref.ckpt
```

### –û—à–∏–±–∫–∞: "Timeout"
- –£–≤–µ–ª–∏—á—å—Ç–µ timeout –≤ RunPod
- –£–º–µ–Ω—å—à–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**: https://github.com/alihojaev/comics-inpaint
- **RunPod Console**: https://console.runpod.io
- **LaMa Original**: https://github.com/advimman/lama
- **–ú–æ–¥–µ–ª—å**: https://huggingface.co/dreMaz/AnimeMangaInpainting

## ‚úÖ Checklist –¥–ª—è –¥–µ–ø–ª–æ—è

- [ ] –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ GitHub
- [ ] –ú–æ–¥–µ–ª—å `lama_large_512px.ckpt` –Ω–∞ –º–µ—Å—Ç–µ
- [ ] –õ–æ–∫–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ
- [ ] RunPod –∞–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω
- [ ] Endpoint —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç
- [ ] API —Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞

## üéâ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è —É –≤–∞—Å –±—É–¥–µ—Ç:
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–π API –¥–ª—è –∏–Ω–ø–µ–π–Ω—Ç–∏–Ω–≥–∞ –º–∞–Ω–≥–∏/–∞–Ω–∏–º–µ
- ‚úÖ CPU-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –Ω–µ—á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

---

**–°–æ–∑–¥–∞–Ω–æ**: 2025-10-07  
**–í–µ—Ä—Å–∏—è**: CPU Serverless  
**–°—Ç–∞—Ç—É—Å**: Ready for Production üöÄ
