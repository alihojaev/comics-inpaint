# ğŸš€ Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚ - LaMa Anime/Manga CPU

## âœ… Ğ§Ñ‚Ğ¾ ÑƒĞ¶Ğµ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¾

1. **ĞœĞ¾Ğ´ĞµĞ»ÑŒ**: `lama_large_512px.ckpt` (195MB) - Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ° Ğ½Ğ° Ğ°Ğ½Ğ¸Ğ¼Ğµ/Ğ¼Ğ°Ğ½Ğ³Ğµ
2. **CPU Dockerfile**: `Dockerfile.cpu` - Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ´Ğ»Ñ CPU
3. **Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ ÑĞºÑ€Ğ¸Ğ¿Ñ‚**: `simple_test.py` - Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğº Ğ·Ğ°Ğ¿ÑƒÑĞºÑƒ
4. **ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ**: `build_and_test_cpu.sh` - ÑĞ±Ğ¾Ñ€ĞºĞ° + Ñ‚ĞµÑÑ‚ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¾Ğ¹

## ğŸ¯ Ğ¡ĞµĞ¹Ñ‡Ğ°Ñ Ğ¸Ğ´Ñ‘Ñ‚

Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Docker Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ° `lama-anime-cpu:latest` (Ğ·Ğ°Ğ¹Ğ¼Ñ‘Ñ‚ ~5-10 Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ñ€Ğ°Ğ·)

ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ:
```bash
tail -f /tmp/docker_build.log
```

Ğ˜Ğ»Ğ¸:
```bash
docker images | grep lama-anime
```

## ğŸƒ Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¿Ğ¾ÑĞ»Ğµ ÑĞ±Ğ¾Ñ€ĞºĞ¸

### Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 1: Docker (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ)

```bash
cd /Users/alizhan_nh/Desktop/ai/manga-inpaint

# Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Ñ‚ĞµÑÑ‚
docker run --rm \
    -v $(pwd)/test_input:/app/test_input \
    -v $(pwd)/outputs:/app/outputs \
    lama-anime-cpu:latest

# Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ² outputs/test_result.png
```

### Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 2: Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾ (Ğ±ĞµĞ· Docker)

```bash
cd /Users/alizhan_nh/Desktop/ai/manga-inpaint
./run_local.sh
```

Ğ­Ñ‚Ğ¾Ñ‚ ÑĞºÑ€Ğ¸Ğ¿Ñ‚:
- Ğ¡Ğ¾Ğ·Ğ´Ğ°ÑÑ‚ Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ `venv/`
- Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
- Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ inference Ğ½Ğ° CPU
- Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ² `outputs/`

## ğŸ“ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²

ĞŸĞ¾ÑĞ»Ğµ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° Ğ² `outputs/` Ğ±ÑƒĞ´ÑƒÑ‚:
- `test_result.png` - Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
- `test_result_hq.png` - Ğ²Ñ‹ÑĞ¾ĞºĞ¾Ğµ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾

## ğŸ”§ ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ÑĞ²Ğ¾Ğ¸Ñ… Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹

### Docker
```bash
docker run --rm \
    -v /path/to/your/images:/app/test_input \
    -v $(pwd)/outputs:/app/outputs \
    -e IMAGE_PATH=/app/test_input/your_image.png \
    -e MASK_PATH=/app/test_input/your_mask.png \
    lama-anime-cpu:latest
```

### Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾
```bash
export IMAGE_PATH=test_input/your_image.png
export MASK_PATH=test_input/your_mask.png
python3 simple_test.py
```

## ğŸ“‹ Ğ¢Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğº Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸ÑĞ¼

- **Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚**: PNG Ğ¸Ğ»Ğ¸ JPEG
- **ĞœĞ°ÑĞºĞ°**: 
  - Ğ§Ñ‘Ñ€Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ğ½ (0, 0, 0)
  - Ğ‘ĞµĞ»Ñ‹Ğµ Ğ¾Ğ±Ğ»Ğ°ÑÑ‚Ğ¸ Ğ´Ğ»Ñ Ğ¸Ğ½Ğ¿ĞµĞ¹Ğ½Ñ‚Ğ¸Ğ½Ğ³Ğ° (255, 255, 255)
- **Ğ Ğ°Ğ·Ğ¼ĞµÑ€Ñ‹**: Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ğ½ÑÑÑ‚ÑÑ Ğº ĞºÑ€Ğ°Ñ‚Ğ½Ñ‹Ğ¼ 8

## ğŸ¨ ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¼Ğ°ÑĞºĞ¸

```
Ğ˜ÑÑ…Ğ¾Ğ´Ğ½Ğ¾Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ:    ĞœĞ°ÑĞºĞ°:                Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ANIME     â”‚          â”‚   â–‘â–‘â–‘â–‘â–‘     â”‚        â”‚   ANIME     â”‚
â”‚   ğŸ§â€â™€ï¸ [X]   â”‚  +       â”‚   â–‘â–‘â–‘â–ˆâ–‘â–‘    â”‚   =    â”‚   ğŸ§â€â™€ï¸ [âœ“]  â”‚
â”‚   SCENE     â”‚          â”‚   â–‘â–‘â–‘â–‘â–‘     â”‚        â”‚   SCENE     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         (â–ˆ = Ğ¾Ğ±Ğ»Ğ°ÑÑ‚ÑŒ)           (Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾)
```

## ğŸ› Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹

### Docker Ğ¾Ğ±Ñ€Ğ°Ğ· Ğ½Ğµ ÑĞ¾Ğ±Ñ€Ğ°Ğ»ÑÑ
```bash
# ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸
tail -100 /tmp/docker_build.log

# ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ½Ğ¾Ğ²Ğ°
cd /Users/alizhan_nh/Desktop/ai/manga-inpaint
docker build -f Dockerfile.cpu -t lama-anime-cpu:latest .
```

### ĞĞµÑ‚ outputs/
```bash
mkdir -p outputs
```

### ĞÑˆĞ¸Ğ±ĞºĞ° "module not found"
```bash
# Ğ”Ğ»Ñ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°
rm -rf venv
./run_local.sh
```

## ğŸ“Š ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ

**CPU (Apple Silicon M-series)**
- Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸: ~5-10 ÑĞµĞº
- Inference 512x512: ~10-30 ÑĞµĞº
- Inference 1024x1024: ~30-90 ÑĞµĞº

**CPU (Intel/AMD)**
- Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸: ~10-20 ÑĞµĞº
- Inference 512x512: ~20-60 ÑĞµĞº
- Inference 1024x1024: ~60-180 ÑĞµĞº

## ğŸš€ Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ ÑˆĞ°Ğ³Ğ¸

1. âœ… Ğ”Ğ¾Ğ¶Ğ´Ğ°Ñ‚ÑŒÑÑ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ ÑĞ±Ğ¾Ñ€ĞºĞ¸
2. âœ… Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ñ‚ĞµÑÑ‚
3. âœ… ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²
4. ğŸ“ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ rp_handler.py Ğ´Ğ»Ñ RunPod Serverless
5. ğŸš€ Ğ—Ğ°Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¸Ñ‚ÑŒ Ğ½Ğ° RunPod

## ğŸ“ ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹

```bash
# Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ ÑĞ±Ğ¾Ñ€ĞºĞ¸
tail -f /tmp/docker_build.log

# Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²
docker images

# Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¾Ğ±Ñ€Ğ°Ğ·
docker rmi lama-anime-cpu:latest

# Ğ˜Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼ (Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ°)
docker run --rm -it \
    -v $(pwd)/test_input:/app/test_input \
    -v $(pwd)/outputs:/app/outputs \
    --entrypoint /bin/bash \
    lama-anime-cpu:latest
```

## ğŸ“š Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ

- [README_CPU.md](README_CPU.md) - ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ
- [simple_test.py](simple_test.py) - ĞšĞ¾Ğ´ inference
- [Dockerfile.cpu](Dockerfile.cpu) - Docker ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
- [LaMa Official](https://github.com/advimman/lama) - ĞÑ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹

---

**Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¾**: 2025-10-07  
**ĞœĞ¾Ğ´ĞµĞ»ÑŒ**: lama_large_512px.ckpt  
**ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ°**: CPU (Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ)  
**Ğ¦ĞµĞ»ÑŒ**: ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ° Ğº Ğ´ĞµĞ¿Ğ»Ğ¾Ñ Ğ½Ğ° RunPod Serverless

